include:
  - ./docker/infra.yaml

services:
  backend_a:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: backend_a
    ports:
      - "8000:5000"          # HOST:CONTENEDOR
    networks:
      - my_network
    environment:
      - SERVICE_NAME=backend_a
      - DATABASE_URL=postgresql://postgres:example@db:5432/postgres
    volumes:
      - ./backend/src:/app/src
      - temp_data:/app/temp_data
    depends_on:
      - db

  backend_b:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: backend_b
    ports:
      - "8001:5000"          # HOST:CONTENEDOR
    networks:
      - my_network
    environment:
      - SERVICE_NAME=backend_b
      - DATABASE_URL=postgresql://postgres:example@db:5432/postgres
      - INIT_DB=1            # ← Solo esta réplica inicializa DB
    volumes:
      - ./backend/src:/app/src
      - temp_data:/app/temp_data
    depends_on:
      - db

volumes:
  temp_data:

networks:
  my_network:
